<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Dashboard Home</title>

    <!-- Bootstrap Core CSS -->
    <link href="static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="static/vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="static/css/sb-admin-2.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="static/vendor/morrisjs/morris.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="static/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- Datatable -->
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">

    <style type="text/css"> img {cursor: zoom-in; } </style>
    

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">Retail Shelf Manager</a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-tasks">
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Store 1 Task 1</strong>
                                        <span class="pull-right text-muted">40% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                            <span class="sr-only">40% Complete (success)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Store 1 Task 2</strong>
                                        <span class="pull-right text-muted">20% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                            <span class="sr-only">20% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Store 2 Task 1</strong>
                                        <span class="pull-right text-muted">60% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (warning)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>Task History</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-tasks -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="#">
                                <div class="alert alert-danger">
                                    <i class="fa fa-envelope fa-fw"></i> Critical Alert
                                    <span class="pull-right text-muted small">Compliance failure in Store 3</span>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <div class="alert alert-info">
                                    <i class="fa fa-envelope fa-fw"></i> Inventory Update
                                    <span class="pull-right text-muted small">Store 3 inventory updated</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>Notification History</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-alerts -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="login.html"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                            </div>
                            <!-- /input-group -->
                        </li>
                        <li>
                            <a href="index"><i class="fa fa-home fa-fw"></i> Home</a>
                        </li>
                        <li>
                            <a href="store"><i class="fa fa-database fa-fw"></i> Store Management</a>
                        </li>
                        <li>
                            <a>
                              <i class="fa fa-cogs fa-fw"></i>
                              Update Compliance
                              <span class="fa arrow"></span>
                            </a>
                            <ul class="nav nav-second-level collapse" aria-expanded="true" style="">
                                <li>
                                    <a href="fileUpload"><i class="fa fa-image fa-fw"></i> Upload Files</a>
                                </li>
                                <li>
                                    <a href="results"><i class="fa fa-bar-chart-o fa-fw"></i> Results</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div class="row">
                <div class="container-fluid">
                  <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                      <a href="index">Dashboard</a>
                    </li>
                    <li class="breadcrumb-item active">Results</li>
                  </ol>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            Results History
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div id="myTable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <table width="100%" class="table display dataTable no-footer dtr-inline" id="myTable" role="grid" aria-describedby="myTable_info" style="width: 100%;">
                                            <thead style="background-color: #ffb31a">
                                                <tr role="row">
                                                    <th class="sorting_asc" tabindex="0" aria-controls="myTable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">Date/Time</th>
                                                    <th class="sorting" tabindex="0" aria-controls="myTable" rowspan="1" colspan="1" aria-label="Platform(s): activate to sort column ascending">SessionID</th>
                                                    <th class="sorting" tabindex="0" aria-controls="myTable" rowspan="1" colspan="1" aria-label="Browser: activate to sort column ascending">Store</th>
                                                    <th class="sorting" tabindex="0" aria-controls="myTable" rowspan="1" colspan="1" aria-label="Platform(s): activate to sort column ascending">No. of Shelves</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tableBody"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- <div class="col-lg-3">
                                <form role="form">
                                    <div class="form-group">
                                        <label>Select Result</label>
                                        <select id="selectID" class="form-control"></select>
                                    </div>
                                </form>
                            </div>
                            <div class="col-lg-3"><button type="button" class="btn btn-primary" style="margin-top: 11%">Show Metric</button></div> -->
                        </div>
                    </div>
                </div>
            </div>
            <hr size="10px">
            <div class="row">
                <div class="col-lg-3">
                    <form role="form">
                        <div class="form-group">
                            <label>Select Result</label>
                            <select id="selectID" class="form-control"></select>
                        </div>
                    </form>
                </div>
                <div class="col-lg-3"><button type="button" class="btn btn-primary" onclick="loadResults()" style="margin-top: 11%">Show Metric</button></div>
            </div>
            <div id="myResults" style="display: none;"><hr size="10px">
            <div class="row">
                <div class="col-lg-12">
                    <h3>Insights from Shelves</h3>
                </div>
                <!-- <div class="col-lg-12"> -->
                    <!-- <div class="panel panel-success"> -->
                        <!-- <div class="panel-heading">
                            Shelf Metrics
                        </div> -->
                        <!-- /.panel-heading -->
                        <!-- <div class="panel-body"> -->
                <div class="modal fade" id="enlargeImageModal" tabindex="-1" role="dialog" aria-labelledby="enlargeImageModal" aria-hidden="true">
                    <div class="modal-dialog modal-lg" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                        </div>
                        <div class="modal-body">
                          <img src="" class="enlargeImageModalSource" style="width: 100%;">
                        </div>
                      </div>
                    </div>
                </div>
                <div class="col-lg-12">
                    <ul class="nav nav-tabs" id="shelf-holder"></ul>
                    <div class="panel"><div class="panel-body"><div class="tab-content" id="shelf-content"></div></div></div>
                </div>
            </div></div>
            <!-- <hr size="30px"> -->
            <br/><br/>
        </div>
    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->

    <script src="static/vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="static/vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="static/vendor/metisMenu/metisMenu.min.js"></script>

    <script src="static/scripts/js/charts.js"></script>
    <script src="https://code.highcharts.com/highcharts.src.js"></script>


    <!-- Morris Charts JavaScript -->
    <!-- <script src="static/vendor/raphael/raphael.min.js"></script>
    <script src="static/vendor/morrisjs/morris.min.js"></script>
    <script src="static/data/morris-data.js"></script> -->

    <!-- Custom Theme JavaScript -->
    <script src="static/scripts/js/sb-admin-2.js"></script>

    <!-- Datatable -->
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
    <script src="http://code.highcharts.com/highcharts-more.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>       
            
    <!-- <script type="text/javascript" src="static/scripts/js/flot/jquery.flot.js"></script> -->
    <!-- <script type="text/javascript" src="static/scripts/js/flot/jquery.flot.time.js"></script> -->
    <!-- <script type="text/javascript" src="static/scripts/js/flot/jquery.flot.symbol.js"></script> -->
    <!-- <script type="text/javascript" src="static/scripts/js/flot/jquery.flot.axislabels.js"></script> -->
    <script type="text/javascript">
        var uuid
        var shelfCount
        function fillTable(data, Id) {
            if (Id == "myTable") {
                var table = $('#'+Id).DataTable({
                    data: data
                });
            }
            else {
                var table = $('#'+Id).DataTable({
                    data: data,
                    "paging":   false,
                    "info":     false,
                    "searching": false
                });   
            }
            $('#'+Id+' tbody').on( 'click', 'tr', function () {
                if ( $(this).hasClass('selected') ) {
                    $(this).removeClass('selected');
                }
                else {
                    table.$('tr.selected').removeClass('selected');
                    $(this).addClass('selected');
                    if (Id == "myTable") {
                        document.getElementById("selectID").value = $(this.childNodes[1])[0].innerHTML
                        uuid = document.getElementById("selectID").value
                        shelfCount = $(this.childNodes[3])[0].innerHTML
                    }
                }
            } );
            if (Id == "myTable")
                fillForm(data);
        }

        function fillForm(data) {
            var form = document.getElementById('selectID')
            for (ind in data) {
                var op = document.createElement('option')
                op.innerHTML = data[ind][1]
                form.appendChild(op)
            }
        }

        function fillBrandOption(data, j) {
            var form = document.getElementById("brandSelect")
            for (var i = 1; i < data.length; i++) {
                var op = document.createElement('option')
                op.innerHTML = data[i].split(" ").filter(Boolean)[0]
                form.appendChild(op)
            }
            form.value
        }

        function createContent(j) {
            shelfContent = document.getElementById("shelf-content");
            div = document.createElement("div");
            div.className = "tab-pane fade";
            div.id = "Images_"+j.toString();

            // well = document.createElement("div")
            // well.className = "well well-lg"

            cont = document.createElement("div");
            cont.className = "col-lg-10";
            cont.id = "ImagesContent_"+j.toString();

            // cont.appendChild(p);
            // cont.appendChild(well);
            div.appendChild(cont);
            shelfContent.appendChild(div);

            //Content
            main = document.createElement("div")
            main.className = "col-lg-2"
            main.appendChild(document.createElement("br"))

            ul = document.createElement("ul")
            ul.className = "nav nav-pills"
            ul.id = "OptionControl_"+j.toString()
            
            tabC = document.createElement("div")
            tabC.className = "tab-content"
            opName = ['Image Timeline', 'Category Landscape', 'Product Postioning', 'Out of Stock & Compliance']

            for (var i = 1; i < 5; i++) {
                li = document.createElement("li")
                a = document.createElement("a")
                a.href = "#ImagesContentOp_"+j.toString()+"_"+i.toString()
                a.className = "nav-tabs nav-stacked"
                // a.style = "background-color: yellow; color: black"
                a.setAttribute("data-toggle", "tab");
                a.setAttribute("aria-expanded", "false");
                a.innerHTML = opName[i-1]
                li.appendChild(a)
                ul.appendChild(li)

                option = document.createElement("div")
                option.className = "tab-pane fade"
                option.id = "ImagesContentOp_"+j.toString()+"_"+i.toString()

                tabC.appendChild(option)
            }
            main.appendChild(ul)
            div.appendChild(main)

            cont.appendChild(tabC)
        }

        function toggleDataSeries(e) {
            if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                e.dataSeries.visible = false;
            }
            else {
                e.dataSeries.visible = true;
            }
            chart.render();
        }

        function createCanvas(placeholder, data, type) {
            if (type == 0) {
                var chart = new CanvasJS.Chart(placeholder,
                {
                    height: 300,
                    width: 300,
                    animationEnabled: true,
                    toolTip: {
                        shared: true
                    }
                });
                var datapoint = []
                var sD = []
                var col = ["red", "green", "blue", "yellow", "orange", "purple", "brown", "peach"]
                for (var i = 0; i < data.length; i++) {
                    if (i == 0)
                        continue
                    datapoint = []
                    var rowData = data[i].split(" ").filter(Boolean)
                    for (var j = 1; j < rowData.length - 2; j++)
                        datapoint.push({ label: "Shelf "+j.toString(), y: parseFloat(rowData[j])})
                    sD.push({ type: type, name: rowData[0], dataPoints: datapoint, color: col[i]})
                }
                chart.options.data = sD
                setTimeout(function() {chart.render();}, 3000);
            }
            else
            {
                datapoint = []
                for (var i = 1; i < data.length; i++) {
                    rowData = data[i].split(" ").filter(Boolean)
                    sD = []
                    for (var j = 1; j < rowData.length-2; j++)
                        sD[j-1] = parseInt(rowData[j])
                    datapoint[i-1] = {name: rowData[0], data: sD}
                }
                // console.log(datapoint)
                cat = []
                for (var i = 0; i < datapoint[0]["data"].length; i++) {
                    cat[i] = "Shelf "+(i+1).toString()
                }
                Highcharts.chart(placeholder, {
                    title: {
                        text: "Shelf Wise Product Facings"
                    },
                    chart: {
                        type: 'column'
                    },
                    xAxis: {
                        categories: cat
                    },
                    yAxis: {
                        allowDecimals: false,
                        min: 0,
                        title: {
                            text: 'SKU Facings'
                        }
                    },
                    tooltip: {
                        formatter: function () {
                            return '<b>' + this.x + '</b><br/>' +
                                this.series.name + ': ' + this.y + '<br/>' +
                                'Total: ' + this.point.stackTotal;
                        }
                    },
                    plotOptions: {
                        column: {
                            stacking: 'normal'
                        }
                    },
                    series: datapoint
                });
            }
        }

        function createPie(placeholder, data, type) {
            if (type == 0) {
                var chart = new CanvasJS.Chart(placeholder,
                {
                    height: 300,
                    width: 300,
                    theme: "theme2",
                    animationEnabled: true,
                    toolTip: {
                        shared: true
                    },
                    data: [
                    {
                        type: "pie",
                        ndexLabelPlacement: "outside",
                        showInLegend: true,
                        toolTipContent: "{indexLabel} - {y}%",
                        legendText: "{indexLabel}",
                        explodeOnClick: true,
                        fillOpacity: 0.9,
                        dataPoints : []
                    }]
                });
                var datapoint = []
                for (var i = 0; i < data.length; i++) {
                    if (i == 0)
                        continue
                    var rowData = data[i].split(" ").filter(Boolean)
                    datapoint.push({ indexLabel: rowData[0], y: parseFloat(rowData[rowData.length-1])})
                }
                chart.options.data[0].dataPoints = datapoint
                setTimeout(function() {chart.render();}, 3000);
            }
            else {
                datapoint = []
                for (var i = 1; i < data.length; i++) {
                    rowData = data[i].split(" ").filter(Boolean)
                    datapoint[i-1] = {name: rowData[0], y: parseFloat(rowData[rowData.length-2])}
                }
                // console.log(datapoint)
                setTimeout(function() {
                    Highcharts.chart(placeholder, {
                        title: {
                            text: ""
                        },
                        chart: {
                            plotBackgroundColor: null,
                            plotBorderWidth: null,
                            plotShadow: false,
                            type: 'pie',
                            width: 300
                        },
                        tooltip: {
                            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                        },
                        plotOptions: {
                            pie: {
                                allowPointSelect: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    enabled: false
                                },
                                showInLegend: true
                            }
                        },
                        series: [{
                            name: "Brands",
                            colorByPoint: true,
                            data: datapoint
                        }]
                    });
                }, 3000);
            }
        }

        function createHeatMap(placeholder, data) {
            datapoint = []
            cat = []
            for (var i = 1; i < data.length-1; i++) {
                rowData = data[i].split(" ").filter(Boolean)
                // console.log(rowData)
                d = []
                for (var j = 1; j < data.length-1; j++)
                    d[j-1] = 0;
                d[i-1] = parseFloat(rowData[rowData.length-1])
                // console.log(d)
                datapoint[i-1] = {name: rowData[0], data: d}
                cat[i-1] = rowData[0]
            }
            Highcharts.chart(placeholder, {
                title: {
                    text: "Availbility Visibility Index"
                },
                chart: {
                    type: 'column',
                    width: 300
                },
                xAxis: {
                    categories: cat
                },
                yAxis: {
                    allowDecimals: false,
                    min: 0,
                    title: {
                        text: 'AVI'
                    }
                },
                tooltip: {
                    formatter: function () {
                        return '<b>' + this.x + '</b><br/>' +
                            this.series.name + ': ' + this.y + '<br/>' +
                            'Total: ' + this.point.stackTotal;
                    }
                },
                plotOptions: {
                    column: {
                        stacking: 'normal'
                    }
                },
                series: datapoint
            });
        }

        function createHeatView(placeholder, data, brand) {
            datapoint = []
            lab  = []
            for (var i = 1; i < data.length; i++) {
                rowName = data[i].split(" ")[0]
                if (rowName != brand)
                    continue
                noOfShelves = 4
                rowData = data[i].match(/\[(\[\d+\.\d+\]\, )+\[\d+\.\d+\]\]/g)
                // console.log("rowData ", rowData) 
                
                for (var j = 1; j < noOfShelves; j++){
                    secData = rowData[j-1].replace(/\]/g,"").replace(/\[/g,"").split(", ")
                    // console.log("secData ", secData)
                    shelfCountN = secData.length
                    for (var t = 1; t <= shelfCountN; t++) {
                        // console.log((j-1)*(noOfShelves-1) + (t-1), j, shelfCountN-t+1, parseFloat(secData[t-1]))
                        datapoint[(j-1)*(noOfShelves-1) + (t-1)] = {brand: rowName, x: j, y: shelfCountN-t+1, z: parseFloat(secData[t-1])};
                        text = "Horizontal View"
                        xaxis = "Positions"
                        yaxis = "Brands"
                        pointF = '<tr><th colspan="2"><h3>{point.brand}</h3></th></tr>' +
                            '<tr><th>Position: </th><td>{point.x}</td></tr>' +
                            '<tr><th>Facings: </th><td>{point.z}</td></tr>'
                    }
                    lab[j-1] = noOfShelves-j
                }
            }
            cat = ["Left", "Middle", "Right"]
            console.log("datapoint ",datapoint)
            Highcharts.chart(placeholder, {

                chart: {
                    type: 'bubble',
                    plotBorderWidth: 1,
                    zoomType: 'xy',
                    width: 350
                },

                legend: {
                    enabled: false
                },

                title: {
                    text: text
                },

                xAxis: {
                    gridLineWidth: 1,
                    title: {
                        text: xaxis
                    },
                    labels: {
                        formatter: function() {
                            return cat[this.value-1];
                        }
                        // format: '{value}'
                    },
                    plotLines: [{
                        color: 'black',
                        dashStyle: 'dot',
                        width: 2,
                        value: 1,
                        zIndex: 3
                    }]
                },

                yAxis: {
                    startOnTick: false,
                    endOnTick: false,
                    title: {
                        text: yaxis
                    },
                    labels: {
                        formatter: function() {
                            return lab[this.value-1];
                        }
                    },
                    maxPadding: 0.2,
                    plotLines: [{
                        color: 'black',
                        dashStyle: 'dot',
                        width: 2,
                        value: 1,
                        zIndex: 3
                    }]
                },

                tooltip: {
                    useHTML: true,
                    headerFormat: '<table>',
                    pointFormat: pointF,
                    footerFormat: '</table>',
                    followPointer: true
                },

                series: [{
                    data: datapoint
                }]

            });
        }

        // function heatViewUpdate(elem) {
        //     id = elem.parentNode.id
        //     createHeatView("Graph_"+id.toString()+"_4", data["ProdHorz"][id-1], elem.value)
        // }

        function createBubble(placeholder, data, mode) {
            datapoint = []
            cat  = []
            lab  = []
            for (var i = 1; i < data.length; i++) {
                
                if (mode == 1){
                    noOfShelves = 4
                    rowData = data[i].match(/\[(\[\d+\.\d+\]\, )+\[\d+\.\d+\]\]/g)
                    // console.log("rowData ", rowData)
                    rowName = data[i].split(" ")[0] 
                }
                else {
                    rowData = data[i].split(" ").filter(Boolean)
                    noOfShelves = rowData.length - 2
                }
                
                for (var j = 1; j < noOfShelves; j++){
                    if (mode == 0){
                        datapoint[(i-1)*(noOfShelves-1) + (j-1)] = {brand: rowData[0], x: i, y: noOfShelves-j, z: parseFloat(rowData[j])};
                        text = "Vertical View"
                        xaxis = "Brands"
                        yaxis = "Shelf from Top"
                        pointF = '<tr><th colspan="2"><h3>{point.brand}</h3></th></tr>' +
                        // '<tr><th>Shelf No:</th><td>{point.y}</td></tr>' +
                        '<tr><th>Facings:</th><td>{point.z}</td></tr>'
                    }
                    else{
                        // console.log(rowData[0], j, i, parseFloat(rowData[j]))
                        // for (var t = 1; t <= shelfCount; t++) {
                        secData = rowData[j-1].replace(/\]/g,"").replace(/\[/g,"").split(", ")
                        // console.log("secData ", secData)
                        datapoint[(i-1)*(noOfShelves-1) + (j-1)] = {brand: rowName, x: j, y: i, z: Math.round(secData.reduce(function(acc, val) { return parseFloat(acc) + parseFloat(val); }))};    
                        text = "Horizontal View"
                        xaxis = "Positions"
                        yaxis = "Brands"
                        pointF = '<tr><th colspan="2"><h3>{point.brand}</h3></th></tr>' +
                            '<tr><th>Position: </th><td>{point.x}</td></tr>' +
                            '<tr><th>Facings: </th><td>{point.z}</td></tr>'
                    }
                }
                if (mode == 0) {
                    cat[i-1] = rowData[0]
                    lab[i-1] = noOfShelves-i
                }
                else
                    lab[i-1] = rowName
            }
            if (mode == 1)
                cat = ["Left", "Middle", "Right"]
            // console.log("datapoint ",datapoint)
            Highcharts.chart(placeholder, {

                chart: {
                    type: 'bubble',
                    plotBorderWidth: 1,
                    zoomType: 'xy',
                    width: 350
                },

                legend: {
                    enabled: false
                },

                title: {
                    text: text
                },

                xAxis: {
                    gridLineWidth: 1,
                    title: {
                        text: xaxis
                    },
                    labels: {
                        formatter: function() {
                            return cat[this.value-1];
                        }
                        // format: '{value}'
                    },
                    plotLines: [{
                        color: 'black',
                        dashStyle: 'dot',
                        width: 2,
                        value: 1,
                        zIndex: 3
                    }]
                },

                yAxis: {
                    startOnTick: false,
                    endOnTick: false,
                    title: {
                        text: yaxis
                    },
                    labels: {
                        formatter: function() {
                            return lab[this.value-1];
                        }
                    },
                    maxPadding: 0.2,
                    plotLines: [{
                        color: 'black',
                        dashStyle: 'dot',
                        width: 2,
                        value: 1,
                        zIndex: 3
                    }]
                },

                tooltip: {
                    useHTML: true,
                    headerFormat: '<table>',
                    pointFormat: pointF,
                    footerFormat: '</table>',
                    followPointer: true
                },

                series: [{
                    data: datapoint
                }]

            });
        }

        function createCompliance(placeholder, dataC, dataS) {
            datapoint = []
            cat = []
            var i
            totT = 0; compT = 0
            for (i = 1; i < dataC.length; i++) {
                comp = Array.apply(null, Array(dataC.length)).map(Number.prototype.valueOf,0);
                tot = 0
                rowData = dataC[i].split(" ").filter(Boolean)
                rowDataS = dataS[i].split(" ").filter(Boolean)
                
                prod = 0
                for (var j = 1; j < rowData.length-2; j++)
                    prod += parseInt(rowData[j])

                if (prod < 3)
                    console.log("")
                else {
                    comp[i-1] += prod
                    if (prod < 10) 
                        tot += 10
                    else
                        tot += 15
                    if (parseInt(rowDataS[1]) > 0)
                        comp[i-1] -= parseInt(rowDataS[1])
                }
                if (tot != 0) {
                    totT += tot
                    compT += comp[i-1]
                    comp[i-1] = 100*comp[i-1]/tot
                }
                datapoint[i-1] = {name: rowData[0], data: comp}
                cat[i-1] = rowData[0]
            }
            cat[i-1] = "Overall"
            comp = Array.apply(null, Array(dataC.length)).map(Number.prototype.valueOf,0);
            comp[comp.length-1] = 100*compT/totT
            datapoint[i-1] = {name: "Overall", data: comp}

            // console.log(cat, datapoint)
            Highcharts.chart(placeholder, {
                title: {
                    text: "Product Compliance"
                },
                chart: {
                    type: 'column',
                    width: 300
                },
                xAxis: {
                    categories: cat
                },
                yAxis: {
                    allowDecimals: false,
                    min: 0,
                    title: {
                        text: 'Compliance Percentage'
                    }
                },
                tooltip: {
                    formatter: function () {
                        return '<b>' + this.x + '</b><br/>' +
                            this.series.name + ': ' + this.y + '<br/>'
                    }
                },
                plotOptions: {
                    column: {
                        stacking: 'normal'
                    }
                },
                series: datapoint
            });
        }

        function loadResults() {
            document.getElementById("myResults").style.display = "block" 
            var shelf = document.getElementById("shelf-holder")
            shelf.innerHTML = ""
            document.getElementById("shelf-content").innerHTML = ""
            if (shelfCount == null) {
                // console.log('Enter')
                tr = document.getElementById("myTable").getElementsByTagName("tr")//.childNodes
                // console.log(tr)
                for (var ind = 1; ind < tr.length; ind++) {
                    if (tr[ind].childNodes[1].innerHTML == document.getElementById("selectID").value) {
                        shelfCount = tr[ind].childNodes[3].innerHTML
                        uuid = tr[ind].childNodes[1].innerHTML
                    }
                }
            }

            for (var j = 1; j <= shelfCount; j++) {
                createContent(j);
                a = document.createElement("a");
                a.href = "#Images_"+j.toString();
                a.setAttribute("data-toggle", "tab");
                a.setAttribute("aria-expanded", "false");
                a.innerHTML = "Stitch "+j.toString()

                li = document.createElement("li");
                li.id = ""+j.toString();
                li.onclick = function() {
                    id = this.id;
                    for (var i = 1; i <= 4; i++) {
                        document.getElementById("ImagesContentOp_"+id.toString()+"_"+i.toString()).className = "tab-pane fade"
                        document.getElementById("OptionControl_"+id.toString()).childNodes[1].className = ""
                    }

                    document.getElementById("ImagesContentOp_"+id.toString()+"_1").className = "tab-pane fade active in"
                    document.getElementById("OptionControl_"+id.toString()).childNodes[0].className = "active"
                };
                li.appendChild(a);
                shelf.appendChild(li);
            }
            
            var form = {}
            form['uuid'] = uuid
            form['len'] = shelfCount
            // console.log(uuid)
            $.ajax({
                type: 'POST',
                url: '/getData',
                data: form,
                contentType: 'application/x-www-form-urlencoded',
                async: true,
                success: function(data) {
                    console.log(data)
                    for (var j = 1; j <= shelfCount; j++) {
                        // header = data['ProdQuant'][j-1][0].split(" ").filter(Boolean)
                        str = '<div class="row"><div class="col-lg-6"><h4 align="center">Product Facings</h4><hr size="10px"></hr><div id="myTable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer"><div class="row"><div class="col-sm-12"><table width="100%" class="table display dataTable no-footer dtr-inline" id="ProdQuant_'+j.toString()+'" role="grid" aria-describedby="myTable_info" style="width: 100%;"><thead style="background-color: #d9edf7"><tr role="row"><th class="sorting_asc" tabindex="0" aria-controls="ProdQuant_'+j.toString()+'" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">Brand</th><th class="sorting" tabindex="0" aria-controls="ProdQuant_'+j.toString()+'" rowspan="1" colspan="1" aria-label="Platform(s): activate to sort column ascending">Value</th><th class="sorting" tabindex="0" aria-controls="ProdQuant_'+j.toString()+'" rowspan="1" colspan="1" aria-label="Platform(s): activate to sort column ascending">Facings</th>'
                        $("#ImagesContentOp_"+j.toString()+"_2").append(str+'</tr></thead><tbody id="tableBody"></tbody></table></div></div></div></div><div class="col-lg-6"></br></br><div id="Graph_'+j.toString()+'_1" style="width:300px;height:300px;"></div></div></div><hr size="10px"></hr>')
                        // data['ProdQuant'][j-1].splice(0,1)
                        var sender = []
                        for (i = 0; i < data['ProdQuant'][j-1].length; i++) {
                            if (i == 0)
                                continue
                            temp = data['ProdQuant'][j-1][i].split(" ").filter(Boolean)
                            sender[i-1] = [temp[0], Math.round(100*temp[temp.length-2]/data['Facings'][j-1]).toString()+'%', parseInt(temp[temp.length-2]).toString()+' / '+data['Facings'][j-1].toString()]
                        }
                        fillTable(sender, "ProdQuant_"+j.toString());
                        // createGraph("Graph_"+j.toString()+"_1", data["ProdQuant"][j-1]);
                        createCanvas("Graph_"+j.toString()+"_1", data["ProdQuant"][j-1], 1)
                        // graphData = toJSON("ProdQuant_"+j.toString());
                        // $('#ProdQuant_'+j.toString()).DataTable({
                        //     "data": data['ProdQuant'][j-1]
                        // });



                        header = data['ProdShare'][j-1][0].split(" ").filter(Boolean)
                        str = '<div class="row"><div class="col-lg-6"><h4 align="center">Share Of Shelf</h4><hr size="10px"></hr><div id="myTable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer"><div class="row"><div class="col-sm-12"><table width="100%" class="table display dataTable no-footer dtr-inline" id="ProdShare_'+j.toString()+'" role="grid" aria-describedby="myTable_info" style="width: 100%;"><thead style="background-color: #d9edf7"><tr role="row"><th class="sorting_asc" tabindex="0" aria-controls="ProdShare_'+j.toString()+'" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">Brand</th><th class="sorting" tabindex="0" aria-controls="ProdShare_'+j.toString()+'" rowspan="1" colspan="1" aria-label="Platform(s): activate to sort column ascending">Share of Shelf</th>'
                        // <th class="sorting" tabindex="0" aria-controls="ProdShare_'+j.toString()+'" rowspan="1" colspan="1" aria-label="Platform(s): activate to sort column ascending">Dominant In</th>'

                        $("#ImagesContentOp_"+j.toString()+"_2").append(str+'</tr></thead><tbody id="tableBody"></tbody></table></div></div></div></div><div class="col-lg-6"><div id="Graph_'+j.toString()+'_2" style="width=300px;"></div></div></div>')
                        var sender = []
                        var tot = data['ProdShare'][j-1][1].length - 2
                        for (i = 0; i < data['ProdShare'][j-1].length; i++) {
                            if (i == 0)
                                continue
                            temp = data['ProdShare'][j-1][i].split(" ").filter(Boolean)
                            // console.log(temp)
                            sender[i-1] = [temp[0], Math.round(parseFloat(temp[temp.length-2])).toString()+'%']
                        }
                        // console.log(sender)
                        fillTable(sender, "ProdShare_"+j.toString());
                        createPie("Graph_"+j.toString()+"_2", data["ProdShare"][j-1], 1)

                        len = data["ProdSkew"][j-1].length
                        col = data["ProdSkew"][j-1][1].split(" ").filter(Boolean).length
                        // console.log(len, col, data["ProdSkew"][j-1][len-1][col-1])
                        $("#ImagesContentOp_"+j.toString()+"_3").append('<div class="row"><br/><br/><div class="col-lg-6"><div id="Graph_'+j.toString()+'_3" style="width=300px;"></div><h5 align="center">Total AVI = '+data["ProdSkew"][j-1][len-1].split(" ").filter(Boolean)[col-1]+'</h5></div><div class="col-lg-6"><form role="form"><div class="form-group"><label id="'+j.toString()+'">Select Brand<select id="brandSelect" class="form-control"></select></label></div></form><div id="Graph_'+j.toString()+'_4" style="width=300px;"></div></div><div class="col-lg-12"><hr size="10px"></hr></div></div><div class="row"><h4 align="center" style="color: white; background-color: #8c1aff">Premium Positions</h4><div class="col-lg-6" id="Graph_'+j.toString()+'_5" style="width=300px;"></div><div class="col-lg-6" id="Graph_'+j.toString()+'_6" style="width=300px;"></div></div>')

                        fillBrandOption(data["ProdQuant"][j-1], j)
                        brand = document.getElementById("brandSelect");
                        brand.onchange = function() {
                            // console.log(this.parentNode.id, this, data)
                            createHeatView('Graph_'+this.parentNode.id+'_4', data['ProdHorz'][parseInt(this.parentNode.id)-1], this.value)
                        }
                        
                        createHeatMap("Graph_"+j.toString()+"_3", data["ProdSkew"][j-1])
                        createHeatView("Graph_"+j.toString()+"_4", data["ProdHorz"][j-1], brand.value)
                        createBubble("Graph_"+j.toString()+"_5", data["ProdQuant"][j-1], 0)
                        createBubble("Graph_"+j.toString()+"_6", data["ProdHorz"][j-1], 1)

                        str = '<div class="row"><div class="col-lg-6"><h4 align="center">Out of Stock Products</h4><hr size="10px"></hr><div id="myTable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer"><div class="row"><div class="col-sm-12"><table width="100%" class="table display dataTable no-footer dtr-inline" id="ProdVac_'+j.toString()+'" role="grid" aria-describedby="myTable_info" style="width: 100%;"><thead style="background-color: #d9edf7"><tr role="row"><th class="sorting_asc" tabindex="0" aria-controls="ProdVac_'+j.toString()+'" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Rendering engine: activate to sort column descending">Brand</th>'
                        cols = data['ProdVac'][j-1][0].split(" ").filter(Boolean)
                        for (i = 0; i < cols.length; i++)
                            str += '<th class="sorting" tabindex="0" aria-controls="ProdVac_'+j.toString()+'" rowspan="1" colspan="1" aria-label="Platform(s): activate to sort column ascending">'+cols[i].replace("_"," ")+'</th>'

                        $("#ImagesContentOp_"+j.toString()+"_4").append(str+'</tr></thead><tbody id="tableBody"></tbody></table></div></div></div></div><div class="col-lg-6" id="Graph_'+j.toString()+'_7" style="width=300px;"></div></div><hr size="10px"></hr>')
                        // data['ProdQuant'][j-1].splice(0,1)
                        var sender = []
                        for (i = 0; i < data['ProdVac'][j-1].length; i++) {
                            if (i == 0)
                                continue
                            temp = data['ProdVac'][j-1][i].split(" ").filter(Boolean)
                            push = []
                            for (t = 0; t < temp.length; t++)
                                push[t] = temp[t]
                            sender[i-1] = push
                        }
                        // console.log(sender)
                        fillTable(sender, "ProdVac_"+j.toString());
                        createCompliance("Graph_"+j.toString()+"_7", data['ProdQuant'][j-1], data['ProdSkew'][j-1])
                    }
              },
          });
            $.ajax({
                type: 'POST',
                url: '/downloadImages',
                data: form,
                contentType: 'application/x-www-form-urlencoded',
                async: true,
                success: function(data) {
                    // console.log(data)
                    
                    // console.log("shelfCount = ", shelfCount)
                    for (var j = 1; j <= shelfCount; j++) {
                        str = ''
                        for (var i = 0; i < data["noOfInput"][j-1]; i++) {
                            if (i == 0)
                                str += '<img id="inputIm_'+j.toString()+'_'+i.toString()+'" src="/static/images/input/result_'+j.toString()+'/input_'+i.toString()+'.jpg" style="width: 150px" onclick="enlarge(this)">'
                            else
                                str += '<img id="inputIm_'+j.toString()+'_'+i.toString()+'" src="/static/images/input/result_'+j.toString()+'/input_'+i.toString()+'.jpg" style="display: none; width: 150px" onclick="enlarge(this)">'
                        }
                        // console.log(j, str)

                        $("#ImagesContentOp_"+j.toString()+"_1").append("<ul class='timeline'><li><div class='timeline-badge info'><i class='fa fa-camera'></i></div><div class='timeline-panel'><div class='timeline-heading'><h5 class='timeline-title' align='center' style='font-size: 120%'>Input Images</h5><div align='center' class='tab-content' id='inputIm_"+j.toString()+"'>"+str+"</div><a class='btn btn-default btn-circle hover' style='position: absolute; top: 50%; left: 0;' onclick='changeDiv("+j+", -1)'><</a><a class='btn btn-default btn-circle hover' style='position: absolute; top: 50%; right: 0%;' onclick='changeDiv("+j+", 1)'>></a></div><div class='timeline-body'></div></div></li><li class='timeline-inverted'><div class='timeline-badge warning'><i class='fa fa-image'></i></div><div class='timeline-panel'><div class='timeline-heading'><h5 class='timeline-title' align='center' style='font-size: 120%'>Stitched Output</h5></div><div class='timeline-body'><img src='static/images/stitch/result_"+j.toString()+".jpg' style='width: 300px' onclick='enlarge(this)'></div></div></li><li><div class='timeline-badge success'><i class='fa fa-bar-chart-o'></i></div><div class='timeline-panel'><div class='timeline-heading'><h5 class='timeline-title' align='center' style='font-size: 120%'>Product Detection Output</h5></div><div class='timeline-body'><img src='static/images/results/result_"+j.toString()+".jpg' style='width: 300px' onclick='enlarge(this)'></div></div></li></ul>")
                    }
                },
            });

            document.getElementById("shelf-holder").childNodes[0].className = "active"
            document.getElementById("OptionControl_1").childNodes[0].className = "active"
            document.getElementById("Images_1").className = "tab-pane fade active in"
            document.getElementById("ImagesContentOp_1_1").className = "tab-pane fade active in"
        }

        function changeDiv(j, factor) {
            contain = document.getElementById("inputIm_"+j.toString())
            index = 0
            // console.log(contain)
            for (var t = 0; t < contain.childNodes.length; t++) {
                element = document.getElementById('inputIm_'+j.toString()+'_'+t.toString())
                if (element.style.display != "none")
                    index = t
                    // console.log(t)
                element.style.display = "none"
            }
            index = index + factor
            if (index > contain.childNodes.length - 1)
                index = contain.childNodes.length - 1
            else if (index < 0)
                index = 0
            document.getElementById('inputIm_'+j.toString()+'_'+index.toString()).style.display = "block"
        }

        function enlarge(elem) {
            $('.enlargeImageModalSource').attr('src', elem.src);
            $('#enlargeImageModal').modal('show');
        }

        $(document).ready( function () {
            var data;
            var req = {
                type: "POST",
                url: "/getFolder",
                contentType: "application/x-www-form-urlencoded"
            };

            $.ajax(req).done(function(response){
                data = response["data"];
                fillTable(data, "myTable");
            });
        } );
    </script>
</body>

</html>
